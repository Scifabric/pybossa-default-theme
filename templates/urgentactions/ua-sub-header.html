<script type="text/javascript">
    var click = 0;
    var persons = 0;
    var not_clear_clicked = 0;
    var last_checked = 0;
    var person_name = "";
    var mixed_json = {
        "positive": 0,
        "negative": 0,
        "unsure": 0
    };
    var screen_width = window.screen.width;

    var is_json_empty = 0;
    var is_10_plus_clicked = null;

    function displayFirstQuestion(element){
        element.parent().parent().parent().hide();
        $(".question").show(250);
        $(".individuals-container").parent().show(250);
        $(".individuals-container").show(250);
    }

    $(function () {
        $(".single-individual").hide();
        $(".under-10-individuals").hide();
        $(".ten-plus-individuals").hide();
        $(".finish").hide();

        $(".back-arrow-container").click(function () {
            var class_names = $(this).parent().parent().attr("class").split(" ");
            var class_name = class_names[class_names.length - 1];

            var matches = class_name.match(/\d+/g);
            if (matches[0] > 1) {
                $("." + class_name).hide();
                if (screen_width <= 768) {
                    if (class_name == "single-2") {
                        displayFirstQuestion($(this));
                    }
                }
                $("." + class_name.replace(matches[0], Number(matches[0]) - 1)).show(250);
            } else {
                displayFirstQuestion($(this));
            }
            click = 0;
            console.log(class_name);
            $("#reset").click();
            $(".select-persons").hide();
            setCounterButtonInactive($(".one-person"));
            setCounterButtonInactive($(".more-persons"));
        });

        $(".outcome-result").click(function () {
            $(this).parent().parent().parent().hide();
            var class_names = $(this).parent().parent().parent().attr("class").split(" ");
            var class_name = class_names[class_names.length - 1];
            if (class_name == "single-2") {
                if (person_name != "") {
                    $("#person-name-question").text("Is " + person_name + "?");
                } else {
                    $("#person-name-question").text("Is victim?");
                }
            }
            var matches = class_name.match(/\d+/g);
            $("." + class_name.replace(matches[0], Number(matches[0]) + 1)).show(250);
        });

        $('.person').click(function () {
            var class_names_array = $(this).attr("class").split(" ");
            var class_name = class_names_array[1];
            var person_number = class_name.substr(class_name.length - 1);
            var persons_involved = Number(person_number) + 1;
            if (persons_involved < 2) {

            } else {
                $(this).parent().parent().parent().hide();
                is_10_plus_clicked = null;
                persons = persons_involved;
                if (class_name == "person") {
                    is_10_plus_clicked = 1;
                    persons = 11;
                    $(".ten-plus-individuals").show(250);
                } else {
                    $(".under-10-individuals").show(250);
                }
            }
        });

        $(".next-ua").click(function () {
            $(".btn-submit").click();
            window.location.href = "/project/urgent_actions/newtask";
        });

        $(".one-person").click(function () {

            if (screen_width <= 768){
                $("#confirm-name").click();
            }
            $(this).addClass("clicked");
            $(".question").hide();
            $(".single-individual").show(250);
            $(".under-10-individuals").hide();
            $(".ten-plus-individuals").hide();
            setCounterButtonActive($(this));
            setCounterButtonInactive($(".more-persons"));
            click = 1;
            persons = 1;
        });

        $(".more-persons").click(function () {
            $(this).addClass("clicked");
            $(".one-person").css("background-color", "transparent");
            $(".one-person").css("color", "#fff");
            if (click == 0) {
                setCounterButtonActive($(this));
                for (var i = 0; i < 2; i++) {
                    var person_head = $(".person" + i).find('.person-head');
                    var person_body = $(".person" + i).find('.person-body');
                    setPersonActive(person_head, person_body);
                }
                click = 2;
            } else {
                click = 0;
                setCounterButtonInactive($(this));
            }
            $(".select-persons").animate({width: 'toggle'}, 250);
        });

        $("#victims-number-unclear").click(function () {
            if (not_clear_clicked == 0) {
                $("#victims-number").hide(250);
                $("#victims-number-unclear").css({
                    "background-color": "#ffff00",
                    "color": "#000"
                });
                not_clear_clicked = 1;
            } else {
                $("#victims-number").show(250);
                $("#victims-number-unclear").css({
                    "background-color": "transparent",
                    "color": "#fff"
                });
                not_clear_clicked = 0;
            }
        });

        $("#mixed-continue").hide();

        $("#mixed").click(function () {
            if (!is_10_plus_clicked) {
                $(".Q2").hide();
                $(".final-step").hide();
                $(".mixed").show();
                $(".victims-body").empty();
                for (var i = 0; i < persons; i++) {
                    var victims_html = "";
                    if (screen_width > 767) {
                        $(".victims-body").css("padding", "0 20px 0 20px");
                        victims_html = "<div class='form-group mixed-persons mixed-persons" + i + "' style='height:40px; width: 14px; margin-top: 5px; text-align: center;'><div class='person-head' style='text-align: center;'><img src='/static/img/head.png' style='width: 11px; height: 11px;'></div><div class='person-body' style='margin-top: 3px; text-align: center;'><img src='/static/img/body.png' style='width: 11px; height: 20px;'></div></div>";
                    } else {
                        victims_html = "<div class='mixed-persons mixed-persons" + i + "' style='float: left; height:40px; width: 14px; margin-top: 5px; text-align: center;'><div class='person-head' style='text-align: center;'><img src='/static/img/head.png' style='width: 11px; height: 11px;'></div><div class='person-body' style='margin-top: 3px; text-align: center;'><img src='/static/img/body.png' style='width: 11px; height: 20px;'></div></div>";
                    }

                    $(".positive-victims-body").append(victims_html);
                    $(".negative-victims-body").append(victims_html);
                    $(".unsure-victims-body").append(victims_html);
                }
                $('.victims').css({"width": 20 * (persons + 1) + "px", "float": "left"});
                onVictimsHover("mixed-persons", 0, last_checked);

                $(".mixed-persons").on("click", function () {
                    var class_names_array = $(this).attr("class").split(" ");
                    var clas_name = class_names_array[class_names_array.length - 1];
                    var person_number = clas_name.substr(clas_name.length - 1);

                    setSelectedVictimsType($(this), Number(person_number) - last_checked);

                    var sum = 0;
                    for (var item in mixed_json) {
                        sum += mixed_json[item];
                    }
                    if (sum == persons) {
                        $("#mixed-continue").show(250)
                    } else {
                        $("#mixed-continue").hide()
                    }

                    var classes_array = ["positive-victims-body", "negative-victims-body", "unsure-victims-body"];

                    for (var i = last_checked; i <= Number(person_number); i++) {
                        var person_head = $(this).parent().find(".mixed-persons" + i).find('.person-head');
                        var person_body = $(this).parent().find(".mixed-persons" + i).find('.person-body');
                        var class_names = $(this).parent().attr("class").split(" ");
                        var class_name = class_names[class_names.length - 1];
                        $(this).parent().find(".mixed-persons" + i).addClass("disabled");
                        classes_array.remove(class_name);
                        for (var j = 0; j < classes_array.length; j++) {
                            var other_class_name = $("." + classes_array[j].replace("-body", "")).find(".mixed-persons" + i);
                            other_class_name.addClass("disabled");
                            var other_person_head = other_class_name.find('.person-head');
                            var other_person_body = other_class_name.find('.person-body');
                            setPersonDisabled(other_person_head, other_person_body);
                        }
                        setPersonActive(person_head, person_body);
                    }

                    for (var k = Number(person_number) + 1; k <= persons; k++) {
                        var person_head = $(this).parent().find(".mixed-persons" + k).find('.person-head');
                        var person_body = $(this).parent().find(".mixed-persons" + k).find('.person-body');
                        //                    var class_names = $(this).parent().attr("class").split(" ");
                        setPersonDisabled(person_head, person_body);
                        $(this).parent().addClass('disabled');
                        $(this).parent().find(".mixed-persons" + k).addClass("disabled");
                    }

                    for (var c = 0; c < class_names_array.length; c++) {
                        var val = class_names_array[c];
                        var matches = val.match(/\d+/g);
                        if (matches != null) {
                        }
                        var last_checked_person_number = val.substr(val.length - 1);
                        last_checked = Number(last_checked_person_number) + 1;
                    }

                    $(".mixed-persons").off("mouseleave");
                    $(".mixed-persons").off("mouseenter");
                    onVictimsHover("mixed-persons", 0, last_checked);
                    $(".disabled").off("mouseleave");
                    $(".disabled").off("mouseenter");
                });
            }
        });

        $(".continue-vno").click(function () {
            var parent_div = $(this).parent().parent().parent().parent()
            var class_names = parent_div.attr("class").split(" ");
            parent_div.hide();
            var class_name = class_names[class_names.length - 1];
            var matches = class_name.match(/\d+/g);
            $("." + class_name.replace(matches[0], Number(matches[0]) + 1)).show(250);
        });

        onVictimsHover("person", 1, 0);

        $("#reset").click(function () {
            $(".disabled").removeClass("disabled");
            $("#mixed-continue").hide();
            onVictimsHover("mixed-persons", 0, 0);
            $(".mixed-persons").each(function () {
                last_checked = 0;
                var person_head = $(this).find('.person-head');
                var person_body = $(this).find('.person-body');
                setPersonInactive(person_head, person_body);
                mixed_json = {
                    "positive": 0,
                    "negative": 0,
                    "unsure": 0
                }
            });
        });
    });

    function setSelectedVictimsType(element, person_number) {
        var mixed_types_array = ["positive", "negative", "unsure"];
        var mixed_types = element.parent().attr("class");
        for (var item = 0; item < mixed_types_array.length; item++) {
            if (mixed_types.indexOf(mixed_types_array[item]) > -1) {
                if (is_json_empty == 0) {
                    mixed_json[mixed_types_array[item]] = Number(person_number) + 1
                } else {

                }
            }
        }
    }

    function onVictimsHover(person_class, flag, last_checked) {
        $("." + person_class).mouseenter(function () {
            var class_names_array = $(this).attr("class").split(" ");
            var class_name = class_names_array[class_names_array.length - 1];
            var person_number = class_name.substr(class_name.length - 1);
            if (class_name == person_class) {
                $("#person-counter").text("11+");
                person_number = 10;
            }
            for (var i = last_checked; i <= Number(person_number); i++) {
                var person_head = $("." + person_class + i).find('.person-head');
                var person_body = $("." + person_class + i).find('.person-body');
                if (flag == 1) {
                    if (i < 2) {
                        continue;
                    } else {
                        setPersonActive(person_head, person_body);
                        $("#person-counter").text(i + 1);
                    }
                } else {
                    setPersonActive(person_head, person_body);
                    var classes_array = ["positive-victims-body", "negative-victims-body", "unsure-victims-body"];
                    var class_names = $(this).parent().attr("class").split(" ");
                    var class_name = class_names[class_names.length - 1];
                    classes_array.remove(class_name);
                    for (var j = 0; j < classes_array.length; j++) {
                        var other_class_name = $("." + classes_array[j].replace("-body", "")).find("." + person_class + i);
                        var other_person_head = other_class_name.find('.person-head');
                        var other_person_body = other_class_name.find('.person-body');
                        setPersonDisabled(other_person_head, other_person_body);
                    }
                }
            }

            if (class_name == person_class) {
                $("#person-counter").text("11+");
            }

        }).mouseleave(function () {
            for (var i = last_checked; i < 10; i++) {
                var person_head = $("." + person_class + i).find('.person-head');
                var person_body = $("." + person_class + i).find('.person-body');
                if (flag == 1) {
                    if (i < 2) {
                        setPersonActive(person_head, person_body);
                        $("#person-counter").text(i + 1);
                    } else {
                        setPersonInactive(person_head, person_body);
                    }
                } else {
                    setPersonInactive(person_head, person_body);
                }
            }
        });

        $("#confirm-name").click(function () {
            $(".single-1").hide();
            $(".single-2").show(250);
            $("#close-popup").click();
        });
    }

    Array.prototype.remove = function () {
        var what, a = arguments, L = a.length, ax;
        while (L && this.length) {
            what = a[--L];
            while ((ax = this.indexOf(what)) !== -1) {
                this.splice(ax, 1);
            }
        }
        return this;
    };

    function setCounterButtonActive(element) {
        element.css("background-color", "#FFFF00");
        element.css("color", "#000");
    }

    function setCounterButtonInactive(element) {
        element.css("background-color", "transparent");
        element.css("color", "#fff");
    }

    function setPersonInactive(person_head, person_body) {
        $(person_head).find('img').prop("src", "/static/img/head.png");
        $(person_body).find('img').prop("src", "/static/img/body.png");
    }

    function setPersonActive(person_head, person_body) {
        $(person_head).find('img').prop("src", "/static/img/head_selected.png");
        $(person_body).find('img').prop("src", "/static/img/body_selected.png");
    }

    function setPersonDisabled(person_head, person_body) {
        $(person_head).find('img').prop("src", "/static/img/head_disabled.png");
        $(person_body).find('img').prop("src", "/static/img/body_disabled.png");
    }

</script>
<div class="row">
    <div class="sub-header-container">
        <div class="question">
            <div class="col-md-12" style="padding: 0;">
                <div class="col-md-offset-2 col-md-8">
                    <div class="individuals-container">
                        <h2>How many human rights victims were campaigned for in the below Urgent Action?</h2>
                        <div class="one-person">
                            <h1>1</h1>
                        </div>
                        <div class="more-persons">
                            <h1>2+</h1>
                        </div>
                        <div class="select-persons" style="display: none; float: left;">
                            <div class="first-five" style="float: left; margin-left: 15px;">
                                <div class="person person0"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person1"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person2"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person3"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person4"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                            </div>
                            <div class="last-five" style="float: left;">
                                <div class="person person5"
                                     style="float:left; padding-right: 2px; height:40px; width: 20px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: right;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: right;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person6"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person7"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person8"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                                <div class="person person9"
                                     style="float:left; height:40px; width: 14px; margin-top: 5px;">
                                    <div class="person-head" style="text-align: center;">
                                        <img src="/static/img/head.png" style="width: 11px; height: 11px;">
                                    </div>
                                    <div class="person-body" style="margin-top: 3px; text-align: center;">
                                        <img src="/static/img/body.png" style="width: 11px; height: 20px;">
                                    </div>
                                </div>
                            </div>
                            <div class="persons-counter person">
                                <label id="person-counter" style="font-size: 24px;">11+</label>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="col-md-2" style="text-align: center">
                    <div class="speach-bubble-container" style="display: none;">
                        <img src="/static/img/speech_bubble.png" class="img img-responsive">
                    </div>
                </div>
            </div>
        </div>

        <div class="single-individual">
            <div class="col-xs-12 col-md-12 single-1" style="padding: 10px 0 0 0;">
                <div class="col-xs-2 col-md-2" style="text-align: center">
                    <div class="back-arrow-container Q1-back-arrow" style="text-align: center; margin-top:25px;">

                    </div>
                    <br>
                </div>
                <div class="col-xs-10 col-md-8">
                    <h2>Please select the personâ€™s full name in the text below, and answer the questions that
                        follow. </h2>
                    <h3 style="margin-top: -5px; font-style: italic;">(To select the name, click and drag over the text,
                        ensuring the full name is highlighted).</h3>
                </div>
                <div class="col-md-2">

                </div>
            </div>
            <div class="col-xs-12 col-md-12 single-2" style="display: none; padding: 10px 0 0 0;">
                <div class="col-xs-2 col-md-2" style="text-align: center">
                    <div class="back-arrow-container" style="text-align: center; margin-top:35px;">

                    </div>
                    <br>
                </div>
                <div class="col-xs-10 col-md-8 outcome-options" style="margin-left: -11px;">
                    <h2>What was the result of this Urgent Action campaign?</h2>
                    <div class="options" style="margin-left: -11px;">
                        <div class="individual-outcome outcome-result">POSITIVE
                        </div>
                        <div class="individual-outcome outcome-result">NEGATIVE
                        </div>
                        <div class="individual-outcome outcome-result">NOT CLEAR
                        </div>
                    </div>
                </div>
                <div class="col-md-2">

                </div>
            </div>

            <div class="col-xs-12 col-md-12 single-3" style="display: none;">
                <div class="col-xs-2 col-md-2" style="text-align: center">
                    <div class="back-arrow-container" style="text-align: center; margin-top:40px;">
                    </div>
                    <br>
                </div>
                <div class="col-xs-10 col-md-8 outcome-options" style="margin-left: -11px;">
                    <h2 id="person-name-question"></h2>
                    <div class="options" style="margin-left: -11px;">
                        <div class="individual-outcome outcome-result">MALE
                        </div>
                        <div class="individual-outcome outcome-result">FEMALE
                        </div>
                        <div class="individual-outcome outcome-result">NOT CLEAR
                        </div>
                    </div>
                </div>
                <div class="col-md-2">

                </div>
            </div>
            <div class="col-xs-12 col-md-12 single-4" style="display: none;">
                {% include "urgentactions/ua-sub-header-final-step.html" %}
            </div>
        </div>

        <div class="under-10-individuals">
            <div class="col-xs-12 col-md-12 under-ten-1">
                {% include "urgentactions/ua-results.html" %}
            </div>
            <div class="col-xs-12 col-md-12 mixed under-ten-2" style="display: none;">
                <div class="col-xs-2 col-md-2" style="text-align: center">
                    <div class="back-arrow-container"
                         style="text-align: center; margin-top:35px;">

                    </div>
                    <br>
                </div>
                <div class="col-xs-10 col-md-8 outcome-options" style="margin-left: -11px;">
                    <h2>Please specify how many people had positive and negative outcomes.</h2>

                    <div class="form-inline">
                        <div class="form-group">
                            <div class="victims positive-victims">
                                <h5>POSITIVE</h5>
                                <div class="victims-body positive-victims-body"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="victims negative-victims" style="margin-left: 10px;">
                                <h5>NEGATIVE</h5>
                                <div class="victims-body negative-victims-body"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="victims unsure-victims" style="margin-left: 10px;">
                                <h5>UNSURE</h5>
                                <div class="victims-body unsure-victims-body"></div>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="form-inline">
                        <div class="form-group">
                            <div class="individual-outcome" id="reset" style="margin-left: 0;">RESET</div>
                        </div>
                        <div class="form-group">
                            <div class="individual-outcome next-ua" style="margin-left: 10px !important;"
                                 id="mixed-continue">NEXT URGENT ACTION
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2"></div>
            </div>
            <div class="col-xs-12 col-md-12 under-ten-3" style="display:none;">
                {% include "urgentactions/ua-sub-header-final-step.html" %}
            </div>
        </div>
        <div class="ten-plus-individuals">
            <div class="col-xs-12 col-md-12 ten-plus-1">
                <div class="col-xs-2 col-md-2" style="text-align: center">
                    <div class="back-arrow-container" style="text-align: center; margin-top:35px;">

                    </div>
                    <br>
                </div>
                <div class="col-xs-10 col-md-8" style="margin-left: -11px;">
                    <h2>Please specify the exact number of victims involved?</h2>
                    <div class="form-inline">
                        <div class="form-group">
                            <h1>ENTER NUMBER</h1>
                        </div>
                        <div class="form-group">
                            <input style="height: 50px; margin: 5px 0 0 5px;" placeholder="How many?" type="text"
                                   class="form-control" id="victims-number" name="victims-number"><br>
                        </div>
                        <div class="form-group outcome-btns">
                            <div class="individual-outcome" id="victims-number-unclear"
                                 style="width: 150px; height: 40px; padding-top: 6px;">NOT CLEAR
                            </div>
                        </div>
                        <div class="form-group outcome-btns">
                            <div class="individual-outcome continue-vno"
                                 style="width: 150px; height: 40px; padding-top: 6px;">CONTINUE
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-2">
                </div>
            </div>

            <div class="col-xs-12 col-md-12 ten-plus-2" style="display: none;">
                {% include "urgentactions/ua-results.html" %}
            </div>
            <div class="col-xs-12 col-md-12 ten-plus-3" style="display: none;">
                {% include "urgentactions/ua-sub-header-final-step.html" %}
            </div>
        </div>
    </div>
</div>